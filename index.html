<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Global BD Supply Chain | 172 Lines Verified Absolute Full Data</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #1B2631; --accent: #27AE60; --current: #1A1A1B; --future: #F1C40F; --bg: #F4F6F7; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; overflow: hidden; }
        #layout { display: flex; height: 100vh; width: 100vw; position: relative; }
        #map { flex-grow: 1; height: 100%; background: #DAEAF1; z-index: 1; }
        #sidebar { position: absolute; left: 0; top: 0; width: 320px; height: 100%; background: white; z-index: 2000; transition: transform 0.5s ease; box-shadow: 5px 0 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        #sidebar.hidden { transform: translateX(-100%); }
        #toggle-btn { position: absolute; right: -45px; top: 20px; width: 45px; height: 45px; background: var(--primary); color: white; border: none; cursor: pointer; border-radius: 0 8px 8px 0; font-size: 18px; z-index: 2001; }
        .header { background: var(--primary); color: white; padding: 15px; cursor: pointer; }
        .global-cap { background: var(--accent); padding: 12px 15px; color: white; border-bottom: 2px solid rgba(0,0,0,0.1); cursor: pointer; transition: 0.2s; }
        #list-container { flex-grow: 1; overflow-y: auto; background: var(--bg); }
        .group-header { padding: 10px 12px; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 0.8rem; }
        .risk-header-current { background: var(--current); color: white; }
        .risk-header-future { background: var(--future); color: #333; }
        .region-header { background: #cbdceb; color: var(--primary); }
        .country-header { background: #eef2f5; color: #444; padding-left: 20px; font-size: 0.78rem; }
        .collapsible-content { display: none; }
        .open > .collapsible-content { display: block; }
        .plant-card { padding: 10px 12px 10px 30px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 0.72rem; background: white; position: relative; }
        .plant-card:hover { background: #f0f7ff; }
        .plant-card.current-risk { border-left: 5px solid var(--current); }
        .plant-card.future-risk { border-left: 5px solid var(--future); }
        .badge { font-size: 0.6rem; padding: 2px 4px; border-radius: 3px; color: white; background: var(--accent); float: right; margin-left: 5px; }
        .badge.black { background: var(--current); }
        .badge.yellow { background: var(--future); color: #333; }
        .loss-badge { background: #E74C3C; color: white; font-weight: bold; padding: 1px 5px; border-radius: 10px; font-size: 0.6rem; position: absolute; right: 10px; top: 8px; }
        .share-badge { background: #555; color: white; padding: 1px 4px; border-radius: 4px; font-size: 0.55rem; position: absolute; right: 10px; bottom: 8px; }
        .capa-info { color: #666; font-size: 0.62rem; margin-top: 2px; }
    </style>
</head>
<body>
<div id="layout">
    <div id="sidebar">
        <button id="toggle-btn" onclick="document.getElementById('sidebar').classList.toggle('hidden')">üìä</button>
        <div class="header" onclick="resetToGlobal()">
            <h1 style="margin:0; font-size:0.9rem;">Global BD Plant Status</h1>
            <p style="margin:3px 0 0 0; font-size:0.6rem; opacity:0.7;">Verified 172 Lines | Absolute Full Data</p>
        </div>
        <div class="global-cap" onclick="resetToGlobal()">
            <span style="font-size:0.62rem;">Global BD Total Capacity</span><br>
            <strong id="global-val" style="font-size:1rem;">0</strong> <small>K MT/Y</small>
        </div>
        <div id="list-container">
            <div id="current-risk-group" class="open">
                <div class="group-header risk-header-current" onclick="this.parentElement.classList.toggle('open')"><span>‚ö†Ô∏è CURRENT RISK</span><span id="current-total-header"></span></div>
                <div class="collapsible-content" id="current-risk-list"></div>
            </div>
            <div id="future-risk-group" class="open">
                <div class="group-header risk-header-future" onclick="this.parentElement.classList.toggle('open')"><span>üìÖ FUTURE MAINT</span><span id="future-total-header"></span></div>
                <div class="collapsible-content" id="future-risk-list"></div>
            </div>
            <div style="background: var(--primary); color:white; padding:8px 12px; font-size:0.75rem; font-weight:bold;">üåê ALL BD PLANTS BY REGION</div>
            <div id="region-list"></div>
        </div>
    </div>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const plantData = [
        /* NEA - CHINA (61 Lines) */
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Bora LyondellBasell", "location": "Panjin", "capacity": 120, "lat": 40.71, "lng": 122.12, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "China Sanjiang Fine Chem", "location": "Jiaxing", "capacity": 80, "lat": 30.58, "lng": 120.91, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "CHN Energy Ningxia Coal", "location": "Yinchuan", "capacity": 64, "lat": 38.20, "lng": 106.52, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "CSPC Huizhou L1", "location": "Huizhou", "capacity": 165, "lat": 22.75, "lng": 114.65, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "CSPC Huizhou L2", "location": "Huizhou", "capacity": 180, "lat": 22.76, "lng": 114.66, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "CNPC/PDVSA Guangdong", "location": "Jieyang", "capacity": 110, "lat": 22.95, "lng": 116.15, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Daqing Petrochem L1", "location": "Daqing", "capacity": 93, "lat": 46.55, "lng": 125.12, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Daqing Petrochem L2", "location": "Daqing", "capacity": 80, "lat": 46.56, "lng": 125.13, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ExxonMobil Huizhou", "location": "Huizhou", "capacity": 270, "lat": 22.77, "lng": 114.67, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Fujian Gulei Petrochem", "location": "Zhangzhou", "capacity": 130, "lat": 23.93, "lng": 117.61, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "FREP Quanzhou L1", "location": "Quanzhou", "capacity": 60, "lat": 25.15, "lng": 118.95, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "FREP Quanzhou L2", "location": "Quanzhou", "capacity": 120, "lat": 25.16, "lng": 118.96, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Hengli Petrochem", "location": "Dalian", "capacity": 140, "lat": 39.05, "lng": 121.35, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "INEOS SINOPEC Tianjin", "location": "Binhai", "capacity": 150, "lat": 38.68, "lng": 117.65, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Inner Mongolia Jiutai", "location": "Ordos", "capacity": 70, "lat": 39.22, "lng": 109.77, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Jiangsu Sailboat", "location": "Lianyungang", "capacity": 100, "lat": 34.55, "lng": 119.35, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Nanjing Chengzhi Yongqing", "location": "Nanjing", "capacity": 100, "lat": 32.25, "lng": 118.78, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "North Huajin Chem", "location": "Panjin", "capacity": 120, "lat": 40.72, "lng": 122.13, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Dushanzi L1", "location": "Karamay", "capacity": 170, "lat": 44.35, "lng": 84.85, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Dushanzi L2", "location": "Karamay", "capacity": 35, "lat": 44.36, "lng": 84.86, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Fushun L1", "location": "Fushun", "capacity": 30, "lat": 41.88, "lng": 123.95, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Fushun L2", "location": "Fushun", "capacity": 150, "lat": 41.89, "lng": 123.96, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Guangxi", "location": "Qinzhou", "capacity": 180, "lat": 21.95, "lng": 108.62, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Jilin L1", "location": "Jilin", "capacity": 50, "lat": 43.85, "lng": 126.55, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Jilin L2", "location": "Jilin", "capacity": 140, "lat": 43.86, "lng": 126.56, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Jilin L3", "location": "Jilin", "capacity": 200, "lat": 43.87, "lng": 126.57, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Lanzhou L1", "location": "Lanzhou", "capacity": 35, "lat": 36.06, "lng": 103.83, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Lanzhou L2", "location": "Lanzhou", "capacity": 90, "lat": 36.07, "lng": 103.84, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Liaoyang", "location": "Liaoyang", "capacity": 30, "lat": 41.27, "lng": 123.18, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Sichuan", "location": "Pengzhou", "capacity": 150, "lat": 30.98, "lng": 103.95, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Satellite Chemical", "location": "Lianyungang", "capacity": 82, "lat": 34.56, "lng": 119.36, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shandong Dongming Petro", "location": "Heze", "capacity": 50, "lat": 35.24, "lng": 115.48, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shandong Jinhai Chem", "location": "Heze", "capacity": 55, "lat": 35.25, "lng": 115.49, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shandong LuQing Petro", "location": "Shouguang", "capacity": 140, "lat": 36.88, "lng": 118.74, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shandong Yulong L1", "location": "Yantai", "capacity": 220, "lat": 37.65, "lng": 120.35, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shandong Yulong L2", "location": "Yantai", "capacity": 220, "lat": 37.66, "lng": 120.36, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shanghai SECCO L1", "location": "Jinshan", "capacity": 90, "lat": 30.74, "lng": 121.43, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shanghai SECCO L2", "location": "Jinshan", "capacity": 90, "lat": 30.75, "lng": 121.44, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shenghong Petrochem", "location": "Lianyungang", "capacity": 200, "lat": 34.54, "lng": 119.34, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinochem Quanzhou", "location": "Quanzhou", "capacity": 120, "lat": 25.17, "lng": 118.97, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Guangzhou", "location": "Guangzhou", "capacity": 30, "lat": 23.13, "lng": 113.26, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Hainan", "location": "Yangpu", "capacity": 130, "lat": 19.74, "lng": 109.18, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Maoming L1", "location": "Maoming", "capacity": 50, "lat": 21.66, "lng": 110.92, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Maoming L2", "location": "Maoming", "capacity": 100, "lat": 21.67, "lng": 110.93, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Qilu L1", "location": "Zibo", "capacity": 55, "lat": 36.81, "lng": 118.06, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Qilu L2", "location": "Zibo", "capacity": 56, "lat": 36.82, "lng": 118.07, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec SABIC Tianjin", "location": "Binhai", "capacity": 200, "lat": 38.69, "lng": 117.66, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shanghai Petrochem L1", "location": "Jinshan", "capacity": 60, "lat": 30.76, "lng": 121.45, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shanghai Petrochem L2", "location": "Jinshan", "capacity": 60, "lat": 30.77, "lng": 121.46, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Yangzi", "location": "Nanjing", "capacity": 110, "lat": 32.26, "lng": 118.79, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ZRCC Ningbo L1", "location": "Ningbo", "capacity": 160, "lat": 29.93, "lng": 121.95, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ZRCC Ningbo L2", "location": "Ningbo", "capacity": 165, "lat": 29.94, "lng": 121.96, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec-SK Wuhan L1", "location": "Wuhan", "capacity": 60, "lat": 30.65, "lng": 114.35, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec-SK Wuhan L2", "location": "Wuhan", "capacity": 130, "lat": 30.66, "lng": 114.36, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Various China Facilities", "location": "Nanjing", "capacity": 130, "lat": 32.20, "lng": 118.70, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Wanhua Chemical", "location": "Yantai", "capacity": 200, "lat": 37.55, "lng": 121.35, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ZPC Zhoushan L1", "location": "Zhoushan", "capacity": 200, "lat": 30.34, "lng": 122.15, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ZPC Zhoushan L2", "location": "Zhoushan", "capacity": 200, "lat": 30.35, "lng": 122.16, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ZPC Zhoushan L3", "location": "Zhoushan", "capacity": 250, "lat": 30.36, "lng": 122.17, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ZhongKe Guangdong", "location": "Zhanjiang", "capacity": 130, "lat": 21.03, "lng": 110.40, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Qixiang Tengda", "location": "Zibo", "capacity": 100, "lat": 36.83, "lng": 118.08, "status": "Normal"},
        /* NEA - JAPAN (9 Lines) */
        {"region": "NEA", "country": "JAPAN", "company": "Chiba BD L1", "location": "Ichihara", "capacity": 85, "lat": 35.50, "lng": 140.09, "status": "Normal"},
        {"region": "NEA", "country": "JAPAN", "company": "Chiba BD L2", "location": "Ichihara", "capacity": 90, "lat": 35.51, "lng": 140.10, "status": "Normal"},
        {"region": "NEA", "country": "JAPAN", "company": "ENEOS Ichihara", "location": "Ichihara", "capacity": 130, "lat": 35.52, "lng": 140.11, "status": "Normal"},
        {"region": "NEA", "country": "JAPAN", "company": "ENEOS Kawasaki L1", "location": "Kawasaki", "capacity": 81, "lat": 35.52, "lng": 139.75, "status": "Normal"},
        {"region": "NEA", "country": "JAPAN", "company": "ENEOS Kawasaki L2", "location": "Kawasaki", "capacity": 115, "lat": 35.53, "lng": 139.76, "status": "Normal"},
        {"region": "NEA", "country": "JAPAN", "company": "Eneos Materials Kashima", "location": "Kashima", "capacity": 120, "lat": 35.92, "lng": 140.66, "status": "Normal"},
        {"region": "NEA", "country": "JAPAN", "company": "Eneos Materials Yokkaichi", "location": "Yokkaichi", "capacity": 148, "lat": 34.96, "lng": 136.65, "status": "Normal"},
        {"region": "NEA", "country": "JAPAN", "company": "Okayama BD Mizushima", "location": "Mizushima", "capacity": 157, "lat": 34.48, "lng": 133.72, "status": "Normal"},
        {"region": "NEA", "country": "JAPAN", "company": "Zeon Corp Shunan", "location": "Shunan", "capacity": 180, "lat": 34.05, "lng": 131.81, "status": "Normal"},
        /* NEA - KOREA (16 Lines) */
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "GS Caltex Yeosu", "location": "Yeosu", "capacity": 130, "lat": 34.84, "lng": 127.68, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "Hanwha TotalEnergies", "location": "Seosan", "capacity": 150, "lat": 37.05, "lng": 126.37, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "Hyundai Chemical", "location": "Seosan", "capacity": 163, "lat": 37.06, "lng": 126.38, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "KPIC Ulsan", "location": "Ulsan", "capacity": 150, "lat": 35.53, "lng": 129.31, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "Kumho Petrochem Ulsan", "location": "Ulsan", "capacity": 90, "lat": 35.54, "lng": 129.32, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "Kumho Petrochem Yeosu", "location": "Yeosu", "capacity": 147, "lat": 34.85, "lng": 127.69, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "LG Chemical Seosan L1", "location": "Seosan", "capacity": 175, "lat": 37.03, "lng": 126.35, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "LG Chemical Seosan L2", "location": "Seosan", "capacity": 55, "lat": 37.04, "lng": 126.36, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "LG Chemical Yeosu L1", "location": "Yeosu", "capacity": 160, "lat": 34.86, "lng": 127.70, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "LG Chemical Yeosu L2", "location": "Yeosu", "capacity": 140, "lat": 34.87, "lng": 127.71, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "Lotte Chemical Seosan", "location": "Seosan", "capacity": 190, "lat": 37.02, "lng": 126.34, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "Lotte Chemical Yeosu", "location": "Yeosu", "capacity": 160, "lat": 34.88, "lng": 127.72, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "S-Oil Ulsan", "location": "Ulsan", "capacity": 101, "lat": 35.55, "lng": 129.33, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "SK Geo Centric Ulsan", "location": "Ulsan", "capacity": 130, "lat": 35.56, "lng": 129.34, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "YNCC Yeosu L1", "location": "Yeosu", "capacity": 240, "lat": 34.83, "lng": 127.67, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "YNCC Yeosu L2", "location": "Yeosu", "capacity": 138, "lat": 34.82, "lng": 127.66, "status": "Maintenance (Current)", "days": 35, "period": "Feb 5 ~ Mar 10"},
        /* NEA - TAIWAN (5 Lines) */
        {"region": "NEA", "country": "TAIWAN", "company": "CPC Lin Yuan L1", "location": "Lin Yuan", "capacity": 100, "lat": 22.48, "lng": 120.40, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "CPC Lin Yuan L2", "location": "Lin Yuan", "capacity": 58, "lat": 22.49, "lng": 120.41, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "Formosa Mailiao L1", "location": "Mailiao", "capacity": 176, "lat": 23.78, "lng": 120.18, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "Formosa Mailiao L2", "location": "Mailiao", "capacity": 162, "lat": 23.79, "lng": 120.19, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "Formosa Mailiao L3", "location": "Mailiao", "capacity": 109, "lat": 23.80, "lng": 120.20, "status": "Normal"},
        /* SEA (13 Lines) */
        {"region": "SEA", "country": "INDONESIA", "company": "Chandra Asri", "location": "Cilegon", "capacity": 137, "lat": -6.01, "lng": 106.01, "status": "Normal"},
        {"region": "SEA", "country": "INDONESIA", "company": "Lotte Chemical ID", "location": "Cilegon", "capacity": 140, "lat": -6.02, "lng": 106.02, "status": "Normal"},
        {"region": "SEA", "country": "MALAYSIA", "company": "Lotte Titan MY", "location": "Pasir Gudang", "capacity": 100, "lat": 1.47, "lng": 103.89, "status": "Normal"},
        {"region": "SEA", "country": "MALAYSIA", "company": "Pengerang Refining", "location": "Pengerang", "capacity": 185, "lat": 1.36, "lng": 104.21, "status": "Normal"},
        {"region": "SEA", "country": "PHILIPPINES", "company": "JG Summit", "location": "Batangas", "capacity": 70, "lat": 13.76, "lng": 121.05, "status": "Normal"},
        {"region": "SEA", "country": "SINGAPORE", "company": "PCS L1", "location": "Jurong Island", "capacity": 100, "lat": 1.27, "lng": 103.72, "status": "Normal"},
        {"region": "SEA", "country": "SINGAPORE", "company": "PCS L2", "location": "Jurong Island", "capacity": 60, "lat": 1.28, "lng": 103.73, "status": "Normal"},
        {"region": "SEA", "country": "SINGAPORE", "company": "Shell Pulau Bukom", "location": "Pulau Bukom", "capacity": 155, "lat": 1.23, "lng": 103.77, "status": "Shutdown (Current)", "days": 365, "period": "Plan for 2026"},
        {"region": "SEA", "country": "THAILAND", "company": "BST L1", "location": "Mueang Rayong", "capacity": 80, "lat": 12.68, "lng": 101.28, "status": "Normal"},
        {"region": "SEA", "country": "THAILAND", "company": "BST L2", "location": "Mueang Rayong", "capacity": 140, "lat": 12.69, "lng": 101.29, "status": "Normal"},
        {"region": "SEA", "country": "THAILAND", "company": "IRPC Rayong", "location": "Mueang Rayong", "capacity": 56, "lat": 12.70, "lng": 101.30, "status": "Normal"},
        {"region": "SEA", "country": "THAILAND", "company": "PTT Global Chem", "location": "Map Ta Phut", "capacity": 75, "lat": 12.71, "lng": 101.15, "status": "Normal"},
        {"region": "SEA", "country": "VIETNAM", "company": "Long Son Petrochem", "location": "Vung Tau", "capacity": 100, "lat": 10.45, "lng": 107.13, "status": "Normal"},
        /* SA (4 Lines) */
        {"region": "SA", "country": "BRAZIL", "company": "Braskem Camacari L1", "location": "Camacari", "capacity": 90, "lat": -12.69, "lng": -38.33, "status": "Normal"},
        {"region": "SA", "country": "BRAZIL", "company": "Braskem Camacari L2", "location": "Camacari", "capacity": 90, "lat": -12.70, "lng": -38.34, "status": "Normal"},
        {"region": "SA", "country": "BRAZIL", "company": "Braskem Santo Andre", "location": "Santo Andre", "capacity": 80, "lat": -23.65, "lng": -46.53, "status": "Normal"},
        {"region": "SA", "country": "BRAZIL", "company": "Braskem Triunfo", "location": "Triunfo", "capacity": 220, "lat": -29.94, "lng": -51.35, "status": "Normal"},
        /* WE (24 Lines) */
        {"region": "WE", "country": "AUSTRIA", "company": "OMV Schwechat", "location": "Schwechat", "capacity": 70, "lat": 48.14, "lng": 16.50, "status": "Normal"},
        {"region": "WE", "country": "BELGIUM", "company": "BASF Antwerpen", "location": "Antwerp", "capacity": 155, "lat": 51.22, "lng": 4.40, "status": "Normal"},
        {"region": "WE", "country": "BELGIUM", "company": "Evonik Antwerpen", "location": "Antwerp", "capacity": 100, "lat": 51.23, "lng": 4.41, "status": "Normal"},
        {"region": "WE", "country": "FINLAND", "company": "Borealis Polymers", "location": "Porvoo", "capacity": 25, "lat": 60.31, "lng": 25.55, "status": "Normal"},
        {"region": "WE", "country": "FRANCE", "company": "Feyzin No.2", "location": "Feyzin", "capacity": 40, "lat": 45.67, "lng": 4.84, "status": "Normal"},
        {"region": "WE", "country": "FRANCE", "company": "Basell Berre-l'Etang", "location": "Berre-l'Etang", "capacity": 80, "lat": 43.48, "lng": 5.16, "status": "Normal"},
        {"region": "WE", "country": "FRANCE", "company": "Naphtachimie Lavera", "location": "Lavera", "capacity": 120, "lat": 43.39, "lng": 4.99, "status": "Normal"},
        {"region": "WE", "country": "FRANCE", "company": "TotalEnergies Gonfreville", "location": "Gonfreville", "capacity": 60, "lat": 49.49, "lng": 0.23, "status": "Normal"},
        {"region": "WE", "country": "GERMANY", "company": "Basell Wesseling", "location": "Wesseling", "capacity": 239, "lat": 50.83, "lng": 6.98, "status": "Normal"},
        {"region": "WE", "country": "GERMANY", "company": "BASF SE", "location": "Mannheim", "capacity": 105, "lat": 49.48, "lng": 8.46, "status": "Normal"},
        {"region": "WE", "country": "GERMANY", "company": "Dow Bohlen", "location": "Bohlen", "capacity": 105, "lat": 51.18, "lng": 12.43, "status": "Normal"},
        {"region": "WE", "country": "GERMANY", "company": "Evonik Marl", "location": "Marl", "capacity": 220, "lat": 51.65, "lng": 7.10, "status": "Normal"},
        {"region": "WE", "country": "GERMANY", "company": "INEOS Dormagen L1", "location": "Dormagen", "capacity": 95, "lat": 51.10, "lng": 6.84, "status": "Normal"},
        {"region": "WE", "country": "GERMANY", "company": "INEOS Dormagen L2", "location": "Dormagen", "capacity": 150, "lat": 51.11, "lng": 6.85, "status": "Normal"},
        {"region": "WE", "country": "GERMANY", "company": "OMV Burghausen", "location": "Burghausen", "capacity": 70, "lat": 48.18, "lng": 12.83, "status": "Normal"},
        {"region": "WE", "country": "ITALY", "company": "Versalis Ravenna", "location": "Ravenna", "capacity": 140, "lat": 44.41, "lng": 12.20, "status": "Normal"},
        {"region": "WE", "country": "NETHERLANDS", "company": "Dow Terneuzen L1", "location": "Terneuzen", "capacity": 85, "lat": 51.33, "lng": 3.82, "status": "Normal"},
        {"region": "WE", "country": "NETHERLANDS", "company": "Dow Terneuzen L2", "location": "Terneuzen", "capacity": 85, "lat": 51.34, "lng": 3.83, "status": "Normal"},
        {"region": "WE", "country": "NETHERLANDS", "company": "SABIC Geleen", "location": "Geleen", "capacity": 130, "lat": 50.96, "lng": 5.82, "status": "Normal"},
        {"region": "WE", "country": "NETHERLANDS", "company": "Shell Moerdijk", "location": "Moerdijk", "capacity": 115, "lat": 51.69, "lng": 4.64, "status": "Normal"},
        {"region": "WE", "country": "PORTUGAL", "company": "Repsol Sines", "location": "Sines", "capacity": 45, "lat": 37.95, "lng": -8.86, "status": "Normal"},
        {"region": "WE", "country": "SPAIN", "company": "Repsol La Pobla L1", "location": "La Pobla", "capacity": 65, "lat": 41.11, "lng": 1.25, "status": "Normal"},
        {"region": "WE", "country": "SPAIN", "company": "Repsol La Pobla L2", "location": "La Pobla", "capacity": 65, "lat": 41.12, "lng": 1.26, "status": "Normal"},
        {"region": "WE", "country": "SPAIN", "company": "Repsol La Pobla L3", "location": "La Pobla", "capacity": 30, "lat": 41.13, "lng": 1.27, "status": "Normal"},
        /* AFRICA (1 Line) */
        {"region": "AFRICA", "country": "EGYPT", "company": "ETHYDCO", "location": "Alexandria", "capacity": 20, "lat": 31.20, "lng": 29.91, "status": "Normal"},
        /* CENTRAL EUROPE (4 Lines) */
        {"region": "CE", "country": "CZECHIA", "company": "Butadien Kralupy", "location": "Kralupy", "capacity": 130, "lat": 50.24, "lng": 14.31, "status": "Normal"},
        {"region": "CE", "country": "HUNGARY", "company": "MOL Petrolkemia", "location": "Tiszaujvaros", "capacity": 130, "lat": 47.92, "lng": 21.05, "status": "Normal"},
        {"region": "CE", "country": "POLAND", "company": "Orlen S.A.", "location": "Plock", "capacity": 70, "lat": 52.54, "lng": 19.70, "status": "Normal"},
        {"region": "CE", "country": "SERBIA", "company": "HIP Petrohemija", "location": "Pancevo", "capacity": 25, "lat": 44.87, "lng": 20.65, "status": "Normal"},
        /* CIS (10 Lines) */
        {"region": "CIS", "country": "KAZAKHSTAN", "company": "KazMunayGas", "location": "Atyrau", "capacity": 66, "lat": 47.10, "lng": 51.91, "status": "Normal"},
        {"region": "CIS", "country": "RUSSIA", "company": "Nizhnekamsk L1", "location": "Nizhnekamsk", "capacity": 100, "lat": 55.63, "lng": 51.82, "status": "Normal"},
        {"region": "CIS", "country": "RUSSIA", "company": "Nizhnekamsk L2", "location": "Nizhnekamsk", "capacity": 88, "lat": 55.64, "lng": 51.83, "status": "Normal"},
        {"region": "CIS", "country": "RUSSIA", "company": "Nizhnekamsk L3", "location": "Nizhnekamsk", "capacity": 60, "lat": 55.65, "lng": 51.84, "status": "Normal"},
        {"region": "CIS", "country": "RUSSIA", "company": "Nizhnekamsk L4", "location": "Nizhnekamsk", "capacity": 90, "lat": 55.66, "lng": 51.85, "status": "Normal"},
        {"region": "CIS", "country": "RUSSIA", "company": "Omsk Kauchuk", "location": "Omsk", "capacity": 60, "lat": 54.98, "lng": 73.37, "status": "Normal"},
        {"region": "CIS", "country": "RUSSIA", "company": "SIBUR Tobolsk L1", "location": "Tobolsk", "capacity": 180, "lat": 58.20, "lng": 68.25, "status": "Normal"},
        {"region": "CIS", "country": "RUSSIA", "company": "Sibur Togliatti", "location": "Togliatti", "capacity": 80, "lat": 53.51, "lng": 49.41, "status": "Normal"},
        {"region": "CIS", "country": "RUSSIA", "company": "Synthez-Kauchuk", "location": "Sterlitamak", "capacity": 45, "lat": 53.63, "lng": 55.94, "status": "Normal"},
        {"region": "CIS", "country": "RUSSIA", "company": "ZapSibNeftekhim", "location": "Tobolsk", "capacity": 100, "lat": 58.21, "lng": 68.26, "status": "Normal"},
        /* INDIA (6 Lines) */
        {"region": "IND", "country": "INDIA", "company": "Haldia Petrochem", "location": "Haldia", "capacity": 100, "lat": 22.02, "lng": 88.06, "status": "Normal"},
        {"region": "CIS", "country": "INDIA", "company": "HPCL Rajasthan", "location": "Barmer", "capacity": 37, "lat": 25.75, "lng": 71.38, "status": "Normal"},
        {"region": "CIS", "country": "INDIA", "company": "Indian Oil Panipat", "location": "Panipat", "capacity": 138, "lat": 29.39, "lng": 76.96, "status": "Normal"},
        {"region": "CIS", "country": "INDIA", "company": "ONGC OPAL Bharuch", "location": "Bharuch", "capacity": 115, "lat": 21.70, "lng": 72.97, "status": "Normal"},
        {"region": "CIS", "country": "INDIA", "company": "Reliance Surat", "location": "Surat", "capacity": 140, "lat": 21.17, "lng": 72.83, "status": "Normal"},
        {"region": "CIS", "country": "INDIA", "company": "Reliance Vadodara", "location": "Vadodara", "capacity": 90, "lat": 22.30, "lng": 73.18, "status": "Normal"},
        /* MIDDLE EAST (7 Lines) */
        {"region": "ME", "country": "IRAN", "company": "Amir Kabir", "location": "Bandar Imam", "capacity": 50, "lat": 30.45, "lng": 49.12, "status": "Normal"},
        {"region": "ME", "country": "IRAN", "company": "Basparan B.I.", "location": "Bandar Imam", "capacity": 26, "lat": 30.46, "lng": 49.13, "status": "Normal"},
        {"region": "ME", "country": "IRAN", "company": "Jam Petrochem", "location": "Asaluyeh", "capacity": 115, "lat": 27.48, "lng": 52.61, "status": "Normal"},
        {"region": "ME", "country": "IRAN", "company": "Persian Gulf", "location": "Bandar Assaluyeh", "capacity": 100, "lat": 27.49, "lng": 52.62, "status": "Normal"},
        {"region": "ME", "country": "IRAN", "company": "Shazand Petrochem", "location": "Arak", "capacity": 35, "lat": 34.09, "lng": 49.69, "status": "Normal"},
        {"region": "ME", "country": "IRAN", "company": "Tabriz Petrochem", "location": "Tabriz", "capacity": 17, "lat": 38.07, "lng": 46.29, "status": "Normal"},
        {"region": "ME", "country": "SAUDI ARABIA", "company": "Petrokemya Jubail", "location": "Al Jubail", "capacity": 197, "lat": 27.01, "lng": 49.66, "status": "Normal"},
        /* NORTH AMERICA (12 Lines) */
        {"region": "NA", "country": "CANADA", "company": "Diamond Petro Sarnia", "location": "Sarnia", "capacity": 120, "lat": 42.97, "lng": -82.40, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "BASF TOTAL", "location": "Port Arthur", "capacity": 410, "lat": 29.88, "lng": -93.93, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "ExxonMobil Baton Rouge", "location": "Baton Rouge", "capacity": 170, "lat": 30.45, "lng": -91.14, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "ExxonMobil Baytown", "location": "Baytown", "capacity": 150, "lat": 29.74, "lng": -94.97, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "INEOS Alvin L1", "location": "Alvin", "capacity": 60, "lat": 29.42, "lng": -95.24, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "INEOS Alvin L2", "location": "Alvin", "capacity": 40, "lat": 29.43, "lng": -95.25, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "K2 Channelview L1", "location": "Channelview", "capacity": 279, "lat": 29.81, "lng": -95.12, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "K2 Channelview L2", "location": "Channelview", "capacity": 113, "lat": 29.82, "lng": -95.13, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "Shell Deer Park", "location": "Deer Park", "capacity": 150, "lat": 29.72, "lng": -95.12, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "Shell Norco", "location": "Norco", "capacity": 261, "lat": 29.99, "lng": -90.41, "status": "Normal"},
        {"region": "NA", "country": "UNITED STATES", "company": "TPC Houston L1", "location": "Houston", "capacity": 309, "lat": 29.71, "lng": -95.24, "status": "Trouble (Current)", "days": 180, "period": "Since Jan 2026"},
        {"region": "NA", "country": "UNITED STATES", "company": "TPC Houston L2", "location": "Houston", "capacity": 206, "lat": 29.72, "lng": -95.25, "status": "Trouble (Current)", "days": 180, "period": "Since Jan 2026"}
    ];

    const regionFlyTo = { 
        "NEA": { c: [32, 122], z: 4 }, 
        "SEA": { c: [5, 110], z: 5 }, 
        "WE": { c: [50, 10], z: 5 }, 
        "ME": { c: [28, 50], z: 5 }, 
        "NA": { c: [38, -95], z: 4 }, 
        "SA": { c: [-20, -55], z: 4 },
        "CIS": { c: [55, 60], z: 4 },
        "IND": { c: [20, 78], z: 5 },
        "CE": { c: [48, 18], z: 6 },
        "AFRICA": { c: [30, 31], z: 6 }
    };
    const regionColors = { "NEA": "#1597BB", "SEA": "#27AE60", "WE": "#8E44AD", "ME": "#F39C12", "NA": "#D35400", "SA": "#7F8C8D", "CIS": "#2980B9", "IND": "#16A085", "CE": "#E67E22", "AFRICA": "#34495E" };

    const map = L.map('map', {zoomControl: false}).setView([20, 10], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    const globalTotalCapa = plantData.reduce((s, p) => s + p.capacity, 0);
    document.getElementById('global-val').innerText = globalTotalCapa.toLocaleString();

    function resetToGlobal() { map.flyTo([20, 10], 2, {duration: 2.0}); }

    function flyWithOffset(latlng, zoom) {
        const sidebar = document.getElementById('sidebar');
        const offset = sidebar.classList.contains('hidden') ? 0 : 320;
        const target = map.project(latlng, zoom).subtract([offset / 2, 0]);
        map.flyTo(map.unproject(target, zoom), zoom, { duration: 2.0 });
    }

    function calculateLoss(p) {
        if (!p.days) return 0;
        return ((p.capacity / 365) * p.days).toFixed(1);
    }

    const currentRisks = plantData.filter(p => p.status.includes('Current'));
    const futureRisks = plantData.filter(p => p.status.includes('Future'));

    const curLossSum = currentRisks.reduce((s, p) => s + parseFloat(calculateLoss(p)), 0);
    const futLossSum = futureRisks.reduce((s, p) => s + parseFloat(calculateLoss(p)), 0);
    const curShare = ((curLossSum / globalTotalCapa) * 100).toFixed(1);
    const futShare = ((futLossSum / globalTotalCapa) * 100).toFixed(1);

    document.getElementById('current-total-header').innerText = `${curLossSum.toLocaleString()}K (${curShare}% Global Loss) ‚ñº`;
    document.getElementById('future-total-header').innerText = `${futLossSum.toLocaleString()}K (${futShare}% Global Loss) ‚ñº`;

    const nested = {};
    plantData.forEach(p => {
        const isCurrent = p.status.includes('Current');
        const isFuture = p.status.includes('Future');
        const m = L.circleMarker([p.lat, p.lng], { radius: Math.sqrt(p.capacity) * 0.65, fillColor: regionColors[p.region], color: isCurrent ? '#1A1A1B' : (isFuture ? '#F1C40F' : '#fff'), weight: (isCurrent || isFuture) ? 5 : 1.5, fillOpacity: 0.8 }).addTo(map);
        
        const lossVal = calculateLoss(p);
        const annualShare = ((p.capacity / globalTotalCapa) * 100).toFixed(2);
        let pop = `<b>${p.company}</b><br>${p.location}<br>Annual Capa: ${p.capacity}K (${annualShare}% Share)<br>Status: <b>${p.status}</b>`;
        if(p.days) pop += `<br><span style="color:red; font-weight:bold;">Loss in Period: ${lossVal}K MT</span><br><small>Period: ${p.period} (${p.days} days)</small>`;
        m.bindPopup(pop); p._m = m;

        if (!nested[p.region]) nested[p.region] = { capa: 0, countries: {} };
        if (!nested[p.region].countries[p.country]) nested[p.region].countries[p.country] = { capa: 0, plants: [] };
        nested[p.region].capa += p.capacity;
        nested[p.region].countries[p.country].capa += p.capacity;
        nested[p.region].countries[p.country].plants.push(p);
    });

    const createCard = (p) => {
        const loss = calculateLoss(p);
        const share = ((p.capacity / globalTotalCapa) * 100).toFixed(2);
        const card = document.createElement('div');
        const isRisk = p.status.includes('Current') || p.status.includes('Future');
        card.className = `plant-card ${p.status.includes('Current')?'current-risk':(p.status.includes('Future')?'future-risk':'')}`;
        const bCol = p.status.includes('Current') ? 'black' : (p.status.includes('Future') ? 'yellow' : '');
        const lossBadge = isRisk ? `<span class="loss-badge">${loss}K Loss</span>` : '';
        const shareBadge = isRisk ? `<span class="share-badge">${share}% Share</span>` : '';
        card.innerHTML = `${lossBadge}${shareBadge}<span class="badge ${bCol}">${p.status.split('(')[0]}</span><b>${p.company}</b><div class="capa-info">${p.capacity}K MT | ${p.days || 0} Days Ï†ïÏßÄ</div>`;
        card.onclick = (e) => { e.stopPropagation(); flyWithOffset([p.lat, p.lng], 9); setTimeout(() => p._m.openPopup(), 1800); };
        return card;
    };

    currentRisks.sort((a,b)=>b.capacity-a.capacity).forEach(p=>document.getElementById('current-risk-list').appendChild(createCard(p)));
    futureRisks.sort((a,b)=>b.capacity-a.capacity).forEach(p=>document.getElementById('future-risk-list').appendChild(createCard(p)));

    Object.entries(nested).sort((a,b)=>b[1].capa - a[1].capa).forEach(([rName, rData]) => {
        const rPct = ((rData.capa / globalTotalCapa) * 100).toFixed(1);
        const rDiv = document.createElement('div');
        rDiv.className = 'region-group';
        rDiv.innerHTML = `<div class="group-header region-header" onclick="flyWithOffset(regionFlyTo['${rName}'].c, regionFlyTo['${rName}'].z); this.parentElement.classList.toggle('open')"><span>${rName} (${rPct}%)</span><span>‚ñº</span></div><div class="collapsible-content"></div>`;
        const countryList = rDiv.querySelector('.collapsible-content');
        Object.entries(rData.countries).sort((a,b)=>b[1].capa - a[1].capa).forEach(([cName, cData]) => {
            const cPct = ((cData.capa / globalTotalCapa) * 100).toFixed(1);
            const cDiv = document.createElement('div');
            cDiv.className = 'country-item';
            cDiv.innerHTML = `<div class="group-header country-header" onclick="this.parentElement.classList.toggle('open')"><span>${cName} (${cPct}%)</span><span>‚ñº</span></div><div class="collapsible-content"></div>`;
            const plantList = cDiv.querySelector('.collapsible-content');
            cData.plants.forEach(p => plantList.appendChild(createCard(p)));
            countryList.appendChild(cDiv);
        });
        document.getElementById('region-list').appendChild(rDiv);
    });
</script>
</body>
</html>
